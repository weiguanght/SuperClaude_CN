# 下一步重构方向概览 (Next Refactor Direction)

## 1. 斜杠命令审计 (Slash Command Audit)

| 命令 | 主要用途 | 与 Claude Code 标准命令是否重复 | 评估备注 |
|---|---|---|---|
| `analyze` | 代码质量/漏洞/性能多维分析 | ❌ | 综合诊断工作流。比标准功能更深入。**建议保留**。 |
| `brainstorm` | 需求发散与多智能体协作 | ❌ | 结合子智能体与 MCP 的高级模式。**独有价值大**。 |
| `build` | 实装前的详细计划与 Wave 控制 | ⚠️ (部分类似) | 与标准 `/build` 不同，包含 Wave/Checkpoint 指引。确认差异后考虑保留。 |
| `business-panel` |由于商业视角评审 | ❌ | 标准功能缺乏的管理视角。**建议保留**。 |
| `cleanup` | 理与重构 | ⚠️ | 类似标准 `/cleanup`，但增加了 PM Agent 步骤与留痕。需重新评估。 |
| `design` | 架构设计协议 | ❌ | 多智能体生成设计文档。**建议保留**。 |
| `document` | 文档维护工作流 | ❌ | 包含信息获取、验证、更新。 |
| `estimate` | 工时/风险估算 | ❌ | 偏向产品管理。**建议保留**。 |
| `explain` | 生成说明 | ⚠️ | 与标准 `/explain` 近似。需确认是否有独特的留痕机制。 |
| `git` | Git 操作指南 | ✅ | 与标准 Git 功能重叠。**删除候选**。 |
| `help` | SuperClaude 命令列表 | ✅ | 仅用于 `/sc:help`。最小配置需要。 |
| `implement` | 实现阶段进度管理 | ⚠️ | 比标准 `/implement` 的留痕要求更严。需分析差异。 |
| `improve` | 改善与重构建议 | ⚠️ | 结构类似标准 `/improve`，但增加了置信度联动。 |
| `index` | 仓库理解与索引 | ❌ | 包含索引生成与利用。**建议保留**。 |
| `load` | 读取会话上下文 | ❌ | 外部记忆利用协议。**建议保留**。 |
| `pm` | PM Agent 本体 | ❌ | 框架核心。**必须**。 |
| `reflect` | 反思 (Reflexion) 循环 | ❌ | 自我评价与重试框架。**建议保留**。 |
| `research` | 深层调研 | ⚠️ | `/research` 虽然标准也有，但本版包含 MCP 指定与留痕。需确认差异。 |
| `save` | 成果汇总与结束处理 | ❌ | 归档与记忆更新。**建议保留**。 |
| `select-tool` | 工具选择判断 | ❌ | 包含 MCP 的工具策略。**建议保留**。 |
| `spawn` | 分派子智能体 | ❌ | 多智能体编排。**建议保留**。 |
| `spec-panel` | 规格评审委员会 | ❌ | 标准功能没有的专家评审。**建议保留**。 |
| `task` | 任务分解与管理 | ⚠️ | 与标准 `/task` 重叠，但增加了 PM Agent 计量。需分析差异。 |
| `test` | 测试策略与留痕 | ⚠️ | 类似 `/test`。需精查附加要求。 |
| `troubleshoot` | 故障调查协议 | ❌ | 事件响应工作流。**建议保留**。 |
| `workflow` | 波动式工作流控制 | ❌ | Wave/Checkpoint 概念汇总。**建议保留**。 |

**分类规则**:
- ✅: 完全重复（可被 Claude Code 标准功能替代）→ 删除/合并候选
- ⚠️: 部分重复（需再确认差异化内容）
- ❌: 独有价值高 → 优先重新收录

### 1.1 `⚠️` 组详细调查

- **build**: 包含 Playwright MCP 与 DevOps 专用的构建报告。**维持价值高**。
- **cleanup**: 包含 Architect/Quality/Security 多面检查与安全回滚。**建议作为 SuperClaude 版重新收录**。
- **explain**: 联动 Educator 角色，生成分级说明。**在教育用途上有独有价值**。
- **implement**: 自动启动多个 MCP 与多角色进行生成和验证。与标准版单体生成差异明显。**必须维持**。
- **improve**: 分类起用专门角色，提供安全改善循环。**建议维持**。
- **research**: 组合多 MCP 进行深挖。比标准版更高级。**必须维持**。
- **task**: 提供 Epic->Story->Task 层级与 Session 延续性。**必须维持**。
- **test**: 包含 QA 角色与 Playwright 的自动修复提案。**维持价值高**。

=> 结论：这 8 个命令虽然名称巧合，但行为有明确增强。**建议全部重新收录**，并在文档中注明区别。

## 2. 文档新鲜度与外部记忆流程概要

1. **SessionStart Hook**:
   - 检查 `PROJECT_INDEX.json`，计算新鲜度分数。
   - 若状态为 `warning/stale`，提示用户刷新索引。
   - 检查 Memory 更新时间，列出陈旧项。
2. **作业前脚手架**:
   - 显示只读的状态看板。
   - 建议 `/sc:index-repo`。
3. **文档验证循环**:
   - 记录 docs 文件的最后访问时间。
   - 发现矛盾时即时发出警告。
   - 在自我评价循环中确认文档状态。
4. **完成时输出**:
   - 报告引用过的文档和索引状态。
   - 必要时更新 `PROJECT_INDEX` 与记忆元数据。

## 3. 子智能体与自我评价遥测指针

- **启动日志**: 简短显示智能体调用。
  - 例: `🤖 Sub-agent: repo-index (mode=diagnose, confidence=0.78)`
- **自我评价循环**: `confidence >= 0.9` 才继续，否则自动重试。
  - 例: `🔁 Reflection loop #2 (reason=confidence 0.64)`
- **输出级别**: 默认简洁，可通过 `/sc:agent --debug` 开启详细日志。
- **HUD 指标**: 任务完成时汇总最新的置信度与反思状态。

## 4. Framework ↔ Plugin 重组路线图 (概要)

1. **资产再导入**:
   - 在 Framework 库中新建 `plugins/superclaude/` 目录，恢复 upstream 内容。
   - 设立 `manifest/` 模板与 `tests/`。
2. **构建与同步任务**:
   - `make build-plugin`: 测试 → 展开模板 → 输出到 `dist`。
   - `make sync-plugin-repo`: 将产物同步到 Plugin 仓库。
3. **Plugin 仓库角色变更**:
   - 仅保留生成物，添加“禁止直接编辑”的声明。
4. **文档更新**:
   - 刷新 `CLAUDE.md`, `README` 等以适配新结构。
