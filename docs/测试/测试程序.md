# 测试程序与 CI/CD (Procedures)

## 测试配置

### pytest 设置
- **测试目录**：`tests/`
- **测试文件模式**：`test_*.py`, `*_test.py`
- **测试类**：`Test*`
- **测试函数**：`test_*`
- **常用选项**：`-v --tb=short --strict-markers`

### 覆盖率设置
- **目标对象**：`superclaude/`, `setup/`
- **排除项**：`*/tests/*`, `*/test_*`, `*/__pycache__/*`
- **目标值**：90% 以上的覆盖率
- **报告**：使用 `show_missing = true` 以显示未覆盖的行

### 测试标记 (Markers)
- `@pytest.mark.slow`：耗时较长的测试（可通过 `-m "not slow"` 排除）
- `@pytest.mark.integration`：集成测试

## 现有测试文件说明
```
tests/
├── test_get_components.py      # 组件获取测试
├── test_install_command.py     # 安装命令测试
├── test_installer.py           # 安装程序测试
├── test_mcp_component.py       # MCP 组件测试
├── test_mcp_docs_component.py  # MCP 文档组件测试
└── test_ui.py                  # UI 测试
```

## 任务完成时的强制检查清单

### 1. 代码质量检查
```bash
# 格式化
black .

# 类型检查
mypy superclaude setup

# Linter 检查
flake8 superclaude setup
```

### 2. 执行测试
```bash
# 执行所有测试
pytest -v

# 覆盖率检查（强制要求 90% 以上）
pytest --cov=superclaude --cov=setup --cov-report=term-missing
```

### 3. 文档更新
- 新增功能 → 更新相应文档。
- API 变更 → 更新 docstring。
- 添加实际使用示例。

### 4. Git 操作
```bash
# 确认变更
git status
git diff

# 提交前再次确认
git diff --staged

# 遵循 Conventional Commits (规范提交)
git commit -m "feat: add new feature"
git commit -m "fix: resolve bug in X"
git commit -m "docs: update installation guide"
```

## CI/CD 工作流

### GitHub Actions
- **publish-pypi.yml**: 自动发布到 PyPI。
- **readme-quality-check.yml**: 文档质量检查。

### 工作流触发条件
- 推送 (Push) 时：执行 Linter、运行测试。
- 拉取请求 (PR) 时：执行质量检查、确认代码覆盖率。
- 创建标签 (Tag) 时：自动发布到 PyPI。

---

## 质量标准

### 代码质量
- 必须通过所有测试。
- 新功能的测试覆盖率必须达到 90% 以上。
- 完备的类型提示 (Type Hints)。
- 健壮的错误处理机制。

### 文档质量
- 公共 API 必须编写文档。
- 必须包含使用示例。
- 遵循阶梯式复杂度引导（从初学者到高级用户）。

### 性能要求
- 大型项目的性能优化。
- 跨平台兼容性。
- 高资源效率的实现。
