# 开源项目 (OSS) 分叉工作流最佳实践 - 2025 (OSS Fork Workflow Best Practices 2025)

**研究日期**：2025-10-16
**上下文**：二层分叉结构 (OSS 上游仓库 → 个人分叉仓库)。
**目标**：保持与上游同步，并在提交 PR 时实现“零冗余提交”的清晰工作流。

---

## 🎯 执行摘要 (Executive Summary)

2025 年针对 OSS 贡献的标准分叉工作流遵循一个核心准则：**绝对不要污染个人分叉仓库的 `master` (或 `main`) 分支**。在同步上游代码时，应使用 **rebase** 而非 merge。在提交 PR 前，利用 **rebase -i** 整理提交历史，确保只提交最纯净的功能差分。

**推荐分支策略**：
- `master` (或 `main`)：上游镜像（仅用于同步，禁止直接提交）。
- `feature/*`：功能开发分支（由 `upstream/master` 派生）。

**“dev”分支应废弃**：其角色通常定位模糊，是导致工作流混乱的主要原因。

---

## 📚 当前结构示例

- **upstream (上游)**：`SuperClaude-Org/SuperClaude_Framework` （项目本家）。
- **origin (个人分叉)**：`kazukinakai/SuperClaude_Framework` （你的分叉）。

---

## ✅ 推荐工作流 (2025 标准)

### 第一阶段：初始设置 (仅需执行一次)
1. 在 GitHub UI 上点击 **Fork**。
2. 将个人分叉仓库 `clone` 到本地。
3. 添加上游远程仓库：`git remote add upstream [上游URL]`。

### 第二阶段：日常开发工作流

#### 第一步：与上游同步
```bash
# 获取上游最新代码
git fetch upstream

# 更新本地 master (需确保是 fast-forward，禁止产生 merge 提交)
git checkout master
git merge upstream/master --ff-only

# 同步至个人远程仓库 (保持 origin/master 与上游一致)
git push origin master
```

#### 第二步：创建功能分支
```bash
# 从最新的本地 master 创建功能分支
git checkout -b feature/pm-agent-redesign master
```

#### 第三步：开发与提交
- 遵循 **原子提交 (Atomic Commits)** 原则：一个提交只负责一个逻辑变更。

#### 第四步：在提交 PR 前进行清理
```bash
# 通过交互式变基清理提交历史
git rebase -i master

# 在编辑器中：
# 将琐碎的提交 (如 fix typo, cleanup) 使用 'squash' 合并到核心功能提交中。
```

#### 第五步：验证差分 (Verify Clean Diff)
在推送前，使用 `git diff master...feature/your-feature` 检查 PR 中将包含的实际内容。确保其中**没有**冗余提交、调试代码或临时文件。

---

## 🚫 应避免的反模式 (Anti-Patterns)

- ❌ **严禁在 master 分支直接提交**：这会导致同步逻辑被破坏。
- ❌ **严禁使用 merge 同步主分支**：这会引入无意义的“Merge branch 'master'...”提交。
- ❌ **严禁在 PR 中包含不相关的变更**：这会增加维护者的审查负担。

---

## 🔧 关于“dev”分支的建议

### 问题：角色重叠且定位模糊
在 OSS 贡献中，“dev”分支的存在往往让开发者困惑：我是该从 master 派生分支，还是从 dev 派生？PR 的基准应该是哪个？

### 最佳解决方案：废弃“dev”分支
**优点**：
- 结构简单明了，符合 OSS 贡献的主流规范。
- 确保 PR 的基准点始终是 `upstream/master`。

---

## 💡 核心总结 (Golden Rule)

**上游 master → 功能分支 → rebase -i 清理 → 提交 PR**

这是 2025 年参与开源项目协作的最专业、最标准的工作流，能够极大提升开发者与项目维护者之间的协作效率。
