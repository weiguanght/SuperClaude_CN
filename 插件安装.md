# SuperClaude 插件安装指南

## 官方安装方法 (推荐)

### 前提条件

1. **安装 ripgrep**
   ```bash
   brew install ripgrep
   ```

2. **环境变量设置** (添加到 `~/.zshrc` 或 `~/.bashrc`)
   ```bash
   export USE_BUILTIN_RIPGREP=0
   ```

3. **重启终端**
   ```bash
   exec $SHELL
   ```

### 安装步骤

#### 方法 A: 通过本地市场 (推荐)

1. 在 Claude Code 中添加市场：
   ```
   /plugin marketplace add [你的项目本地绝对路径]
   ```
   *(例如：`/plugin marketplace add /Users/hoto/SuperClaude`)*

2. 安装插件：
   ```
   /plugin install pm-agent@superclaude-local
   ```

3. 重启 Claude Code。

4. 验证运行：
   ```
   /pm
   /research
   /index-repo
   ```

#### 方法 B: 开发者模式 (直接安装)

**注意**：此方法主要用于开发测试。建议优先使用方法 A。

```bash
# 在项目根目录下执行
make reinstall-plugin-dev
```

重启 Claude Code 后，命令即可使用。

## 安装后可用的命令

### /pm
启动项目管理 (PM Agent) 模式。提供以下功能：
- 90% 信心检查 (实现前)
- 并行执行优化
- Token 预算管理
- 基于证据的开发

### /research
深度研究 (Deep Research) 模式。提供以下功能：
- 并行 Web 搜索 (通过 Tavily MCP)
- 官方文档优先
- 来源验证
- 带置信度的结果分析

### /index-repo
构建仓库索引。提供以下功能：
- 项目结构分析
- Token 消耗降低 94% (从 58K 降至 3K)
- 识别入口点
- 生成模块映射图

## 自动执行钩子 (Hooks)

通过 `SessionStart` 钩子，新的会话启动时会自动执行 `/pm` 命令。

如需禁用，请编辑 `~/.claude/plugins/pm-agent/hooks/hooks.json`。

## 故障排除

### 如果命令未被识别

1. **确认 ripgrep**：
   ```bash
   which rg
   rg --version
   ```
   如未安装：`brew install ripgrep`

2. **确认环境变量**：
   ```bash
   echo $USE_BUILTIN_RIPGREP
   ```
   如未设置：
   ```bash
   echo 'export USE_BUILTIN_RIPGREP=0' >> ~/.zshrc
   exec $SHELL
   ```

3. **检查插件目录**：
   ```bash
   ls -la ~/.claude/plugins/pm-agent/
   ```
   如果不存在，请重新安装：`make reinstall-plugin-dev`

4. **重启 Claude Code**。

### 如果仍然无法使用

请检查 Claude Code 版本。2.0.x 版本存在已知缺陷：
- GitHub Issue #8831: 自定义斜杠命令无法被发现。

规避方案：
- 切换到 NPM 版本 (Homebrew 版本可能存在此问题)。
- 确保 ripgrep 已安装在系统中 (见上述步骤)。

## 插件结构 (参考)

```
~/.claude/plugins/pm-agent/
├── plugin.json          # 插件元数据
├── marketplace.json     # 市场信息
├── commands/            # Markdown 命令定义
│   ├── pm.md
│   ├── research.md
│   └── index-repo.md
└── hooks/
    └── hooks.json       # SessionStart 钩子配置
```

## 开发者信息

如需反映代码更改：
```bash
make reinstall-plugin-dev
# 随后重启 Claude Code
```

## 支持与参考

如遇到问题，请查阅：
- 官方文档: https://docs.claude.com/zh-cn/docs/claude-code/plugins
- GitHub Issues: https://github.com/anthropics/claude-code/issues
- 项目内部文档: `CLAUDE.md`, `PLANNING.md`
