# 项目管理智能体上下文 (PM Agent Context)

**项目名称**：SuperClaude_Framework
**类型**：AI 智能体框架 (AI Agent Framework)
**技术栈**：Claude Code, MCP 服务器, 基于 Markdown 的配置
**当前重心**：具备渐进式上下文加载能力的 Token 效率架构

## 项目概览

SuperClaude 是一个为 Claude Code 打造的综合性框架，提供以下特性：
- 基于角色的专业智能体（前端、后端、安全等）。
- MCP 服务器集成（Context7, Magic, Morphllm, Sequential, Serena 等）。
- 用于工作流自动化的斜杠命令系统。
- 结合 PDCA 循环的自我改进工作流。
- **新增**：采用渐进式加载的 Token 优化型 PM 智能体。

## 架构组成

- `plugins/superclaude/agents/`：智能体角色定义。
- `plugins/superclaude/commands/`：斜杠命令定义（`pm.md` 已针对 Token 效率进行了重新设计）。
- `docs/`：文档与模式库。
- `docs/memory/`：PM 智能体会话状态（本地文件）。
- `docs/pdca/`：针对每个功能的 PDCA 循环记录。
- `docs/research/`：研究报告（如 `llm-agent-token-efficiency-2025.md`）。

## Token 效率架构 (2025-10-17 重新设计)

### 第 0 层：引导 (始终激活)
- **Token 成本**：150 Tokens（较旧版的 2,300 Tokens 降低了 95%）。
- **操作内容**：时间感知 + 仓库检测 + 会话初始化。
- **设计理念**：**用户请求优先** —— 在理解用户意图之前，严禁自动加载。

### 意图分类系统
根据用户请求的关键词分类复杂度：
- **极轻量**："进度", "状态", "更新" → 仅加载第 1 层。
- **轻量**："误字", "重命名", "注释" → 加载第 2 层（目标文件）。
- **中等**："Bug", "修复", "重构" → 加载第 3 层（相关文件）。
- **重量**："新功能", "架构" → 加载第 4 层（子系统）。
- **极重量**："重新设计", "迁移" → 加载第 5 层（全量 + 外部研究）。

### 渐进式加载 (5 层策略)
- **第 1 层**：极简上下文（Mindbase: 500 Tokens | 备选: 800 Tokens）。
- **第 2 层**：目标文件上下文 (500-1K Tokens)。
- **第 3 层**：相关文件上下文 (Mindbase: 3-4K | 备选: 4.5K)。
- **第 4 层**：系统全局上下文（8-12K Tokens，需用户确认）。
- **第 5 层**：外部研究（20-50K Tokens，**必须输出警告信息**）。

### 工作流指标收集
- **文件**：`docs/memory/workflow_metrics.jsonl`
- **用途**：用于工作流优化的持续 A/B 测试。
- **数据**：任务类型、复杂度、工作流 ID、Token 使用量、耗时、成功状态。
- **策略**：ε-贪婪算法（80% 使用最优工作流，20% 用于实验性路径）。

### 错误学习与记忆集成
- **反思记忆 (内置)**：第 1 层仅需 650 Tokens。
- **Mindbase (可选)**：利用语义搜索进一步优化上下文关联。
- **收益**：通过反思记忆可节省 20-35% 的 Token，配合 Mindbase 可再额外节省 10-15%。

## 活跃模式 (Active Patterns)

- **仓库级记忆**：基于 `docs/memory/` 下的文件。
- **PDCA 循环**：计划 (Plan) → 执行 (Do) → 检查 (Check) → 行动 (Act) 的文档工作流。
- **自我评估清单**：替代了原有的 Serena MCP `think_about_*` 函数。
- **用户请求优先**：引导 → 等待 → 识别意图 → 渐进加载 → 执行。
- **持续优化**：通过 `workflow_metrics.jsonl` 进行 A/B 测试。

## 最近变更 (2025-10-17)

### PM 智能体 Token 效率重构
- **移除**：启动时自动加载 7 个文件的行为（曾浪费 2,300 Tokens）。
- **新增**：150 Tokens 的第 0 层引导和意图分类系统。
- **新增**：5 层渐进式加载方案和工作流指标收集。
- **效果**：极轻量任务节省了 72%，轻量任务节省了 66%，中等任务节省了 36%。

---

**最后更新**：2025-10-17
