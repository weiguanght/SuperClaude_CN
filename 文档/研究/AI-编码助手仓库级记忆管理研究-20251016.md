# AI 编码助手的仓库级记忆管理研究 (Repository-Scoped Memory Management)

**研究报告 | 2025-10-16**

## 执行摘要 (Executive Summary)

本研究旨在探讨 AI 编码助手中仓库级记忆（Repository-Scoped Memory）管理的最佳实践，重点关注 SuperClaude PM 智能体的集成。调研显示，**采用 Git 仓库检测的本地文件存储**是目前会话隔离的行业标准，能够提供最优的性能和开发者体验。

### SuperClaude 的核心建议
1. **✅ 采用本地文件存储**：将记忆数据存储在特定仓库目录中（如 `.superclaude/memory/` 或 `docs/memory/`）。
2. **✅ 使用 Git 检测**：通过 `git rev-parse --show-toplevel` 来识别仓库边界。
3. **✅ 先简后繁**：在考虑数据库方案前，优先使用基于文件的方案。
4. **✅ 安全合规**：将动态生成的记忆文件添加到 `.gitignore` 以防泄露。

---

## 1. 行业最佳实践

### 1.1 Cursor IDE 的记忆架构
- **实施模式**：在项目根目录创建 `.cursor/rules` 进行项目特定配置。
- **Memory Bank**：采用结构化的知识库（Markdown 文件）存储跨会话上下文。
- **启示**：验证了使用本地目录进行仓库级隔离的可行性。

### 1.2 GitHub Copilot 工作区上下文
- **机制**：通过远程（云端）和本地索引结合，尊重 `.gitignore` 的排除规则。
- **限制**：上下文作用域通常是工作区级的，默认并非严格的单仓库对应。

---

## 2. 存储架构对比总结

| 特性 | 本地文件 (推荐) | 数据库 (SQL/NoSQL) | 向量数据库 (未来) |
| :--- | :--- | :--- | :--- |
| **性能** | ⭐⭐⭐⭐⭐ 极快 | ⭐⭐⭐ 一般 | ⭐⭐ 较慢 (网络/计算) |
| **复杂度** | ⭐⭐⭐⭐⭐ 极简 | ⭐⭐ 复杂 (需维护) | ⭐ 极复杂 |
| **可读性** | ✅ 人类可直接阅读 | ❌ 需要客户端工具 | ❌ 需要模型检索 |
| **适用场景** | 状态追踪、决策记录 | 跨仓库大数据分析 | 语义化知识库搜索 |

**对 SuperClaude v1 的建议**：**本地文件**是仓库级记忆的绝对首选。

---

## 3. SuperClaude PM 智能体实施方案

### 3.1 目录结构设计 (v1)
```
project-root/
├── .git/                          # 仓库边界
├── .gitignore                     # 需排除 .superclaude/memory/
├── .superclaude/
│   └── memory/
│       ├── session_state.json     # 当前会话上下文状态
│       └── pm_context.json        # PM 智能体的 PDCA 状态
└── docs/
    └── superclaude/               # 可读的长期文档
        ├── patterns/              # 沉淀的成功模式
        └── mistakes/              # 记录并预防犯过的错误
```

### 3.2 上下文隔离策略
当用户从项目 A 切换到项目 B 时：
1. **检测变更**：PM 智能体自动运行 `git rev-parse` 检测到仓库路径已变。
2. **清理/保存**：将项目 A 的记忆存回 A 的目录，清空当前活跃内存。
3. **加载**：从项目 B 的目录加载历史状态。
**收益**：有效消除跨项目的背景噪声干扰。

---

## 4. 实施路线图

### 第一阶段：仓库级文件存储 (即刻)
- [ ] 实现 `get_repository_root()` 的自动检测逻辑。
- [ ] 创建 `.superclaude/memory/` 目录结构。
- [ ] 设置 `.gitignore` 的自动集成。

### 第二阶段：PDCA 记忆集成 (短期)
- [ ] 将计划 (Plan) / 执行 (Do) / 检查 (Check) / 处理 (Act) 的内容持久化。
- [ ] 自动化生成“成功模式”和“错误预防清单”文档。

### 第三阶段：跨仓库模式挖掘 (长期)
- [ ] 实现全局模式数据库。
- [ ] 根据技术栈智能筛选相关经验。

---

## 5. 安全考量
- **敏感信息脱敏**：在存入记忆文件前，使用正则表达式自动屏蔽 Stripe、OpenAI、GitHub 等 API 密钥及 JWT 令牌。

---

## 结论
对于 SuperClaude 而言，仓库级记忆管理的真谛在于**隔离**与**积累**。通过本地化存储，我们既能实现各个项目之间的“背景干净”，又能让 AI 在同一个项目中随着工作流的推进变得越来越聪明。
