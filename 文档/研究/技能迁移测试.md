# 技能迁移测试 —— PM 智能体 (Skills Migration Test)

**日期**：2025-10-21
**目标**：验证零足迹区域 (Zero-footprint) 的技能迁移方案是否可行。

---

## 测试方案设置

### 迁移前（当前状态）
- 路径：`~/.claude/superclaude/agents/pm-agent.md`
- 容量：约 1,927 词 ≈ 2,500 Token。
- 行为：始终加载。Claude Code 启动时会自动读取所有文件。

### 迁移后（技能化架构）
- 路径：`~/.claude/skills/pm/`
  - `SKILL.md`：仅包含描述（约 50 Token）。
  - `implementation.md`：包含具体实现（约 2,500 Token，仅在执行 `/sc:pm` 时加载）。
  - `modules/*.md`：随实现一同加载。
- 行为：Claude Code 启动时仅读取 `SKILL.md`（或完全不读取）。

---

## 预期结果

### 启动时的 Token 占用
- **迁移前**：~2,500 Token（pm-agent.md 始终加载）。
- **迁移后**：0 Token（启动时不加载技能）。
- **节省比例**：100%。

### 执行 /sc:pm 时
- 加载技能描述：~50 Token。
- 加载具体实现：~2,500 Token。
- **总计**：~2,550 Token（仅首次执行时加载）。
- **后续执行**：利用缓存。

### 净收益分析
- **不使用 /sc:pm 的会话**：节省 2,500 Token。
- **使用 /sc:pm 的会话**：产生 50 Token 的额外开销（增幅约 2%）。
- **平衡点**：只要有超过 2% 的会话不使用 PM 功能，该方案即具有净正向收益。

---

## 测试流程

1. **备份当前状态**：`cp -r ~/.claude/superclaude ~/.claude/superclaude.backup`。
2. **创建技能目录结构**：创建 `pm/` 目录并准备 `SKILL.md` 和 `implementation.md`。
3. **更新 Slash 命令**：修改 `plugins/superclaude/commands/pm.md` 以引用新技能 `pm`。
4. **测试执行**：
   - 测试 1：启动时不执行 `/sc:pm`，验证 PM 智能体未加载且启动 Token 降低。
   - 测试 2：手动执行 `/sc:pm`，验证技能按需加载且功能完整。
   - 测试 3：多次执行，验证缓存机制生效，不再重复加载。

---

## 验证清单

- [ ] `SKILL.md` 已创建（~50 Token）。
- [ ] `implementation.md` 已创建（完整内容）。
- [ ] `modules/` 目录已复制到技能目录。
- [ ] Slash 命令已更新（关联 skill: pm）。
- [ ] 启动测试：确认未加载 PM 智能体。
- [ ] 执行测试：`/sc:pm` 成功触发按需加载。
- [ ] 功能测试：所有特性工作正常。
- [ ] Token 测量：确认节省量符合预期。
- [ ] 缓存测试：后续使用不再重新加载。

---

## 成功标准

✅ 启动 Token 占用：0（未加载 PM）。
✅ 执行 `/sc:pm` 获取 Token：约 2,550（描述 + 实现）。
✅ 功能完整性：100% 保留。
✅ Token 节省：对于非 PM 会话，节省比例 > 90%。

---

## 回滚计划

如果技能迁移失败：
1. 删除 `~/.claude/skills/pm`。
2. 恢复备份：`mv ~/.claude/superclaude.backup ~/.claude/superclaude`。
3. 还原 Slash 命令修改：`git checkout plugins/superclaude/commands/pm.md`。

---

## 下一步工作

如果测试成功：
1. 迁移剩余的其他智能体（任务、研究等）。
2. 迁移行为模式（编排、头脑风暴等）。
3. 完全移除 `~/.claude/superclaude/` 目录。
4. 编写基于技能 (Skills-based) 的架构文档。
5. 更新安装系统。
