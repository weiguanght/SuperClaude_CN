# 测试步骤与 CI/CD (Procedures)

## 测试配置

### pytest 设置
- **目录**: `tests/`
- **文件模式**: `test_*.py`, `*_test.py`
- **类**: `Test*`
- **函数**: `test_*`
- **选项**: `-v --tb=short --strict-markers`

### 覆盖率设置
- **目标**: `superclaude/`, `setup/`
- **排除**: `*/tests/*`, `*/test_*`, `*/__pycache__/*`
- **要求**: 覆盖率 90% 以上
- **报告**: `show_missing = true` 显示未覆盖行

### 测试标记 (Markers)
- `@pytest.mark.slow`: 慢速测试 (可用 `-m "not slow"` 排除)
- `@pytest.mark.integration`: 集成测试

## 现有测试结构
```
tests/
├── test_get_components.py      # 组件获取
├── test_install_command.py     # 安装命令
├── test_installer.py           # 安装器逻辑
├── test_mcp_component.py       # MCP 组件
├── test_mcp_docs_component.py  # MCP 文档组件
└── test_ui.py                  # UI 交互
```

## 任务完成时的必须检查清单

### 1. 代码质量检查
```bash
black .                  # 格式化
mypy superclaude setup   # 类型检查
flake8 superclaude setup # Linter
```

### 2. 执行测试
```bash
pytest -v                # 运行所有测试
pytest --cov=superclaude # 检查覆盖率 (>90%)
```

### 3. 文档更新
- 功能增加 → 更新相应文档。
- API 变更 → 更新 docstring。
- 添加使用示例。

### 4. Git 操作
- 提交前确认 `git diff --staged`。
- 遵循 Conventional Commits (`feat:`, `fix:`, `docs:` 等)。

## CI/CD 工作流

### GitHub Actions
- **publish-pypi.yml**: 自动发布到 PyPI.
- **readme-quality-check.yml**: 文档质量检查.

### 触发条件
- Push: 运行 Linter 和测试.
- PR: 运行质量检查和覆盖率确认.
- Tag: 自动发布.

## 质量标准

### 代码质量
- 所有测试必须通过.
- 新功能覆盖率 > 90%.
- 类型提示完备.
- 错误处理完备.

### 文档质量
- 公共 API 必须有文档.
- 包含使用示例.
- 循序渐进 (从入门到精通).

### 性能
- 针对大规模项目进行优化.
- 跨平台兼容.
- 资源效率高.
