# 仓库准则 (Repository Guidelines)

## 项目结构与模块组织
- `src/superclaude/` 存放 Python 包和 pytest 插件入口点。
- `tests/` 包含 Python 集成/单元测试套件；标记（markers）与 `pyproject.toml` 中的功能对应。
- `pm/`、`research/` 和 `index/` 存放带有独立 `package.json` 的 TypeScript 智能体。
- `skills/` 存放运行时技能（如 `confidence-check`）；`commands/` 记录脚本化 Claude 命令。
- `docs/` 提供参考包；从 `docs/developer-guide` 开始了解工作流预期。

## 构建、测试与开发命令
- `make install` 通过 `uv pip install -e ".[dev]"` 以可编辑模式安装框架。
- `make test` 在 `tests/` 目录下运行 `uv run pytest`。
- `make doctor` 或 `make verify` 检查 CLI 连线和插件健康状况。
- `make lint` 和 `make format` 委托给 Ruff；在进行重大修改后运行。
- TypeScript 智能体：在 `pm/` 内部运行一次 `npm install`，然后运行 `npm test` 或 `npm run build`；对 `research/` 和 `index/` 重复此操作。

## 编码风格与命名规范
- Python：4 空格缩进，Black 行宽 88，Ruff 规则 `E,F,I,N,W`；模块/函数优先使用 snake_case，类使用 PascalCase。
- 保持 pytest 标记显式（`@pytest.mark.unit` 等），并匹配文件名 `test_*.py`。
- TypeScript：依赖项目 `tsconfig.json`；文件名保持 kebab-case，导出的类使用 PascalCase；与现有的 PM 智能体模块保持一致。
- 为非显式的编排保留 docstrings 或行内注释；让清晰的命名承担主要说明工作。

## 测试指南
- 默认为 `make test`；在开发期间添加 `uv run pytest -m unit` 以缩小运行范围。
- 当修改触及 CLI 或插件启动时，扩展 `tests/test_pytest_plugin.py` 中的集成覆盖范围。
- 尊重 `src/superclaude` 的覆盖率重心 (`tool.coverage.run`)；通过调整配置而非跳过逻辑来处理。
- 对于 TypeScript 智能体，在 `__tests__/*.test.ts` 下添加 Jest 规范，并通过 `npm run test:coverage` 确保满足覆盖率阈值。

## 提交与拉取请求 (PR) 准则
- 遵循 Conventional Commits (`feat:`, `fix:`, `refactor:`)，参考 `git log`；保持现在时态的摘要在 72 字符以内。
- 按每个 commit 分组相关的敏感文件更新，以简化二分查找（bisect）和发布日志。
- 在开启 PR 前，运行 `make lint`、`make format` 和 `make test`；并在 PR 说明中包含验证步骤的摘要。
- 引用关联的 Issue (`Closes #123`)；对于智能体工作流的更改，添加简要的复现说明；仅在文档更改时添加截图。
- 当触及归属目录时，标记 `CODEOWNERS` 中列出的审阅者。

## 插件部署技巧
- 使用 `make install-plugin` 将开发中的插件镜像到 `~/.claude/plugins/pm-agent`；本地迭代后首选 `make reinstall-plugin`。
- 在分享构件链接或发布日志前，使用 `make test-plugin` 验证插件检测。
