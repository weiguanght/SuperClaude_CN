---
name: sc:index-repo
description: 仓库索引创建 — 实现 94% 的 Token 减量 (58K → 3K)
---

# 仓库索引创建器 (Repository Index Creator)

📊 **索引创建器已激活**

## 问题陈述

**以前**：读取所有文件 → 每会话消耗 58,000 Token。
**现在**：读取 PROJECT_INDEX.md → 仅消耗 3,000 Token（**减少 94%**）。

## 索引创建流程

### 阶段 1：分析仓库结构

**并行分析**（同时执行 5 个 Glob 搜索）：

1. **代码结构**
   ```
   src/**/*.{ts,py,js,tsx,jsx}
   lib/**/*.{ts,py,js}
   superclaude/**/*.py
   ```

2. **文档资料**
   ```
   docs/**/*.md
   *.md (根目录)
   README*.md
   ```

3. **配置信息**
   ```
   *.toml
   *.yaml, *.yml
   *.json (排除 package-lock, node_modules)
   ```

4. **测试脚本**
   ```
   tests/**/*.{py,ts,js}
   **/*.test.{ts,py,js}
   **/*.spec.{ts,py,js}
   ```

5. **脚本与工具**
   ```
   scripts/**/*
   bin/**/*
   tools/**/*
   ```

### 阶段 2：提取元数据

针对每个文件类别提取以下内容：
- 入口点 (main.py, index.ts, cli.py)。
- 关键模块与导出内容。
- API 表面（公共函数/类）。
- 依赖关系 (imports, requires)。

### 阶段 3：生成索引

创建具备以下结构的 `PROJECT_INDEX.md`：

```markdown
# 项目索引：{项目名称}

生成时间：{时间戳}

## 📁 项目结构
{主要目录的树状视图}

## 🚀 入口点
- CLI: {路径} - {描述}
- API: {路径} - {描述}
- 测试: {路径} - {描述}

## 📦 核心模块
### 模块: {名称}
- 路径: {路径}
- 导出: {列表}
- 用途: {一句话描述}

## 🔧 配置
- {配置文件}: {用途}

## 📚 文档
- {文档文件}: {主题}

## 🧪 测试覆盖率
- 单元测试: {数量} 个文件
- 集成测试: {数量} 个文件
- 覆盖率: {百分比}%

## 🔗 关键依赖
- {依赖名}: {版本} - {用途}

## 📝 快速开始
1. {设置步骤}
2. {运行步骤}
3. {测试步骤}
```

### 阶段 4：验证

质量检查：
- [ ] 所有入口点是否均已识别？
- [ ] 核心模块是否均已记录？
- [ ] 索引大小是否控制在 5KB 以内？
- [ ] 格式是否具备良好的人类可读性？

---

## 用法

**创建索引**：
```
/sc:index-repo
```

**更新现有索引**：
```bash
/sc:index-repo mode=update
```

**快速索引 (跳过测试)**：
```bash
/sc:index-repo mode=quick
```

---

## Token 效率

**投资回报率 (ROI) 计算**：
- 索引创建：2,000 Token (一次性)。
- 索引读取：3,000 Token (每个会话)。
- 全量代码库读取：58,000 Token (每个会话)。

**盈亏平衡点**：1 个会话。
**10 个会话累计节省**：550,000 Token。
**100 个会话累计节省**：5,500,000 Token。

---

## 输出格式

生成两个文件：
1. `PROJECT_INDEX.md` (3KB, 人类可读)。
2. `PROJECT_INDEX.json` (10KB, 机器可读)。

---

**索引创建器现已处于活跃状态。** 请立即运行以分析当前仓库。
