# 深度研究配置 (Deep Research Configuration)

## 默认设置

```yaml
research_defaults:
  planning_strategy: unified        # 统一计划策略
  max_hops: 5                      # 最大跳转次数
  confidence_threshold: 0.7        # 置信度阈值
  memory_enabled: true             # 启用记忆
  parallelization: true            # 启用并行化
  parallel_first: true             # 强制默认：并行优先
  sequential_override_requires_justification: true  # 串行覆盖需要理由说明
  
parallel_execution_rules:
  DEFAULT_MODE: PARALLEL           # 默认模式：并行 (强调)
  
  mandatory_parallel:              # 强制并行的场景
    - "多个搜索查询"
    - "批量 URL 提取"
    - "独立的分析任务"
    - "非依赖关系的跳转"
    - "结果处理"
    - "信息提取"
    
  sequential_only_with_justification: # 仅在有理由时使用串行的场景
    - reason: "明确的依赖关系"
      example: "第 N 跳需要第 N-1 跳的结果"
    - reason: "资源约束"
      example: "达到 API 速率限制"
    - reason: "用户要求"
      example: "用户为了调试要求串行"
    
  parallel_optimization:           # 并行优化设置
    batch_sizes:
      searches: 5                  # 每次搜索批大小
      extractions: 3               # 每次提取批大小
      analyses: 2                  # 每次分析批大小
    intelligent_grouping:           # 智能分组
      by_domain: true              # 按域名分组
      by_complexity: true          # 按复杂度分组
      by_resource: true            # 按资源分组
  
planning_strategies:               # 计划策略
  planning_only:                   # 仅计划
    clarification: false           # 是否需要澄清
    user_confirmation: false       # 是否需要用户确认
    execution: immediate           # 执行时机：立即
    
  intent_planning:                 # 意图计划
    clarification: true            # 是否需要澄清
    max_questions: 3               # 最大提问数
    execution: after_clarification # 执行时机：澄清后
    
  unified:                         # 统一模式
    clarification: optional        # 是否需要澄清：可选
    plan_presentation: true        # 显示计划
    user_feedback: true            # 用户反馈
    execution: after_confirmation  # 执行时机：确认后

hop_configuration:                 # 跳转配置
  max_depth: 5                     # 最大深度
  timeout_per_hop: 60s             # 每跳超时时间
  parallel_hops: true              # 并行跳转
  loop_detection: true             # 循环检测
  genealogy_tracking: true         # 谱系跟踪

confidence_scoring:                # 置信度评分
  relevance_weight: 0.5            # 相关性权重
  completeness_weight: 0.5         # 完整性权重
  minimum_threshold: 0.6           # 最低阈值
  target_threshold: 0.8            # 目标阈值

self_reflection:                   # 自我反思
  frequency: after_each_hop        # 频率：每跳之后
  triggers:                        # 触发器
    - confidence_below_threshold   # 置信度低于阈值
    - contradictions_detected      # 检测到矛盾
    - time_elapsed_percentage: 80  # 时间消耗达 80%
    - user_intervention            # 用户干预
  actions:                         # 动作
    - assess_quality               # 评估质量
    - identify_gaps                # 识别差距
    - consider_replanning          # 考虑重新计划
    - adjust_strategy              # 调整策略

memory_management:                 # 记忆管理
  case_based_reasoning: true       # 基于案例的推理
  pattern_learning: true           # 模式学习
  session_persistence: true        # 会话持久化
  cross_session_learning: true     # 跨会话学习
  retention_days: 30               # 保留天数

tool_coordination:                 # 工具协调
  discovery_primary: tavily        # 主要发现工具：Tavily
  extraction_smart_routing: true   # 提取智能路由
  reasoning_engine: sequential     # 推理引擎：Sequential
  memory_backend: serena           # 记忆后端：Serena
  parallel_tool_calls: true        # 并行工具调用

quality_gates:                     # 质量门禁
  planning_gate:                   # 计划门禁
    required_elements: [objectives, strategy, success_criteria] # 必要元素：目标、策略、成功标准
  execution_gate:                  # 执行门禁
    min_confidence: 0.6            # 最低置信度
  synthesis_gate:                  # 综合门禁
    coherence_required: true       # 要求连贯性
    clarity_required: true         # 要求清晰度

extraction_settings:               # 提取设置
  scraping_strategy: selective     # 抓取策略：选择性
  screenshot_capture: contextual   # 截图捕获：上下文相关
  authentication_handling: ethical # 身份验证处理：遵循伦理
  javascript_rendering: auto_detect # JS 渲染：自动检测
  timeout_per_page: 15s            # 每页超时时间
```

## 性能优化

```yaml
optimization_strategies:           # 优化策略
  caching:                         # 缓存
    - Cache Tavily search results: 1 hour     # Tavily 搜索结果缓存 1 小时
    - Cache Playwright extractions: 24 hours  # Playwright 提取结果缓存 24 小时
    - Cache Sequential analysis: 1 hour       # Sequential 分析结果缓存 1 小时
    - Reuse case patterns: always             # 始终重用案例模式

  parallelization:                 # 并行化
    - Parallel searches: max 5     # 并行搜索：最大 5 个
    - Parallel extractions: max 3  # 并行提取：最大 3 个
    - Parallel analysis: max 2     # 并行分析：最大 2 个
    - Tool call batching: true     # 工具调用批处理

  resource_limits:                 # 资源限制
    - Max time per research: 10 minutes       # 每次研究最大时长：10 分钟
    - Max search iterations: 10               # 最大搜索迭代次数：10 次
    - Max hops: 5                             # 最大跳转次数：5 次
    - Max memory per session: 100MB           # 每次会话最大内存：100MB
```

## 策略选择规则

```yaml
strategy_selection:                # 策略选择
  planning_only:                   # 仅计划
    indicators:                    # 指标
      - Clear, specific query      # 查询清晰明确
      - Technical documentation request # 技术文档请求
      - Well-defined scope         # 范围定义明确
      - No ambiguity detected      # 未检测到歧义
    
  intent_planning:                 # 意图计划
    indicators:
      - Ambiguous terms present    # 存在歧义术语
      - Broad topic area           # 主题范围广泛
      - Multiple possible interpretations # 存在多种可能的解释
      - User expertise unknown     # 用户专业水平未知
    
  unified:                         # 统一模式
    indicators:
      - Complex multi-faceted query # 复杂、多层面的查询
      - User collaboration beneficial # 用户协作有益
      - Iterative refinement expected # 预期会有迭代优化
      - High-stakes research       # 高风险/重要研究
```

## 来源可信度矩阵

```yaml
source_credibility:                # 来源可信度
  tier_1_sources:                  # 第一梯队
    score: 0.9-1.0                 # 评分
    types:                         # 类型
      - Academic journals          # 学术期刊
      - Government publications    # 政府出版物
      - Official documentation     # 官方文档
      - Peer-reviewed papers       # 同行评审论文
    
  tier_2_sources:                  # 第二梯队
    score: 0.7-0.9
    types:
      - Established media          # 老牌媒体
      - Industry reports           # 行业报告
      - Expert blogs               # 专家博客
      - Technical forums           # 技术论坛
    
  tier_3_sources:                  # 第三梯队
    score: 0.5-0.7
    types:
      - Community resources        # 社区资源
      - User documentation         # 用户文档
      - Social media (verified)    # 社交媒体 (已认证)
      - Wikipedia                  # 维基百科
    
  tier_4_sources:                  # 第四梯队
    score: 0.3-0.5
    types:
      - User forums                # 用户论坛
      - Social media (unverified)  # 社交媒体 (未认证)
      - Personal blogs             # 个人博客
      - Comments sections          # 评论区
```

## 深度配置

```yaml
research_depth_profiles:           # 研究深度画像
  quick:                           # 快速
    max_sources: 10                # 最大来源数
    max_hops: 1                    # 最大跳转数
    iterations: 1                  # 迭代次数
    time_limit: 2 minutes          # 时间限制
    confidence_target: 0.6         # 目标置信度
    extraction: tavily_only        # 提取方式：仅 Tavily
    
  standard:                        # 标准
    max_sources: 20
    max_hops: 3
    iterations: 2
    time_limit: 5 minutes
    confidence_target: 0.7
    extraction: selective          # 提取方式：选择性
    
  deep:                            # 深度
    max_sources: 40
    max_hops: 4
    iterations: 3
    time_limit: 8 minutes
    confidence_target: 0.8
    extraction: comprehensive      # 提取方式：全面
    
  exhaustive:                      # 极尽
    max_sources: 50+
    max_hops: 5
    iterations: 5
    time_limit: 10 minutes
    confidence_target: 0.9
    extraction: all_sources        # 提取方式：所有来源
```

## 多跳转模式 (Multi-Hop Patterns)

```yaml
hop_patterns:
  entity_expansion:                # 实体扩展
    description: "探索在上一跳中发现的实体"
    example: "论文 → 作者 → 其他作品 → 合作者"
    max_branches: 3
    
  concept_deepening:               # 概念深化
    description: "钻研概念"
    example: "主题 → 子主题 → 详情 → 示例"
    max_depth: 4
    
  temporal_progression:            # 时间维度进展
    description: "遵循年代发展"
    example: "当前 → 近期 → 历史 → 起源"
    direction: backward
    
  causal_chain:                    # 因果链
    description: "追溯因果"
    example: "结果 → 直接原因 → 根本原因 → 预防"
    validation: required
```

## 提取路由规则

```yaml
extraction_routing:
  use_tavily:                      # 使用 Tavily
    conditions:                    # 条件
      - Static HTML content        # 静态 HTML 内容
      - Simple article structure   # 简单的文章结构
      - No JavaScript requirement  # 无 JS 要求
      - Public access              # 公开访问
    
  use_playwright:                  # 使用 Playwright
    conditions:
      - JavaScript rendering required # 需要 JS 渲染
      - Dynamic content present     # 存在动态内容
      - Authentication needed       # 需要身份验证
      - Interactive elements       # 存在交互元素
      - Screenshots required       # 需要截图
    
  use_context7:                    # 使用 Context7
    conditions:
      - Technical documentation    # 技术文档
      - API references             # API 参考
      - Framework guides           # 框架指南
      - Library documentation      # 库文档
    
  use_native:                      # 使用原生
    conditions:
      - Local file access          # 本地文件访问
      - Simple explanations        # 简单解释
      - Code generation            # 代码生成
      - General knowledge          # 通用知识
```

## 基于案例的学习模式 (Case-Based Learning Schema)

```yaml
case_schema:
  case_id:
    format: "research_[timestamp]_[topic_hash]"
    
  case_content:
    query: "原始研究问题"
    strategy_used: "使用的计划方法"
    successful_patterns:           # 成功模式
      - query_formulations: []     # 查询公式化
      - extraction_methods: []     # 提取方法
      - synthesis_approaches: []   # 综合方法
    findings:                      # 发现
      key_discoveries: []          # 关键发现
      source_credibility_scores: {} # 来源可信度评分
      confidence_levels: {}        # 置信水平
    lessons_learned:               # 经验教训
      what_worked: []              # 有效的
      what_failed: []              # 无效的
      optimizations: []            # 优化点
    metrics:                       # 指标
      time_taken: seconds          # 耗时
      sources_processed: count     # 处理的来源数
      hops_executed: count         # 执行的跳转数
      confidence_achieved: float   # 达到的置信度
```

## 重新计划阈值 (Replanning Thresholds)

```yaml
replanning_triggers:
  confidence_based:                # 基于置信度
    critical: < 0.4                # 关键
    low: < 0.6                     # 低
    acceptable: 0.6-0.7            # 可接受
    good: > 0.7                    # 良好
    
  time_based:                      # 基于时间
    warning: 70% of limit          # 警告
    critical: 90% of limit          # 关键
    
  quality_based:                   # 基于质量
    insufficient_sources: < 3      # 来源不足
    contradictions: > 30%          # 矛盾过多
    gaps_identified: > 50%         # 识别出的差距过多
    
  user_based:                      # 基于用户
    explicit_request: immediate    # 显式请求：立即
    implicit_dissatisfaction: assess # 隐式不满：评估
```

## 输出格式模板

```yaml
output_formats:
  summary:                         # 摘要
    max_length: 500 words
    sections: [key_finding, evidence, sources] # 章节：关键发现、证据、来源
    confidence_display: simple     # 置信度显示：简单
    
  report:                          # 报告
    sections: [executive_summary, methodology, findings, synthesis, conclusions] # 章节：执行摘要、方法论、发现、综合、结论
    citations: inline              # 引用：行内
    confidence_display: detailed   # 置信度显示：详细
    visuals: included              # 包含视觉内容
    
  academic:                        # 学术
    sections: [abstract, introduction, methodology, literature_review, findings, discussion, conclusions]
    citations: academic_format
    confidence_display: statistical # 置信度显示：统计式
    appendices: true               # 包含附录
```

## 错误处理

```yaml
error_handling:
  tavily_errors:
    api_key_missing: "检查 TAVILY_API_KEY 环境变量"
    rate_limit: "等待并使用指数退避重试"
    no_results: "扩展搜索词或尝试替代方案"
    
  playwright_errors:
    timeout: "跳过来源或增加超时时间"
    navigation_failed: "标记为不可访问，继续执行"
    screenshot_failed: "在无视觉内容的情况下继续"
    
  quality_errors:
    low_confidence: "触发重新计划"
    contradictions: "寻找额外来源"
    insufficient_data: "扩大搜索范围"
```

## 集成点

```yaml
mcp_integration:
  tavily:
    role: 主要搜索
    fallback: 原生 WebSearch
    
  playwright:
    role: 复杂提取
    fallback: Tavily 提取
    
  sequential:
    role: 推理引擎
    fallback: 原生推理
    
  context7:
    role: 技术文档
    fallback: Tavily 搜索
    
  serena:
    role: 记忆管理
    fallback: 仅限会话 (session_only)
```

## 监控指标

```yaml
metrics_tracking:
  performance:                     # 性能
    - search_latency               # 搜索延迟
    - extraction_time              # 提取时间
    - synthesis_duration           # 综合时长
    - total_research_time          # 总研究时间
    
  quality:                         # 质量
    - confidence_scores            # 置信度得分
    - source_diversity             # 来源多样性
    - coverage_completeness        # 覆盖完整性
    - contradiction_rate           # 矛盾率
    
  efficiency:                      # 效率
    - cache_hit_rate               # 缓存命中率
    - parallel_execution_rate      # 并行执行率
    - memory_usage                 # 内存使用
    - api_cost                     # API 成本
    
  learning:                        # 学习
    - pattern_reuse_rate           # 模式重用率
    - strategy_success_rate        # 策略成功率
    - improvement_trajectory       # 改进轨迹
```
