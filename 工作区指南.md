# 仓库指南 (Repository Guidelines)

## 项目结构与模块组织
- `src/superclaude/` 存放 Python 包和 pytest 插件入口。
- `tests/` 包含 Python 集成/单元测试套件；标记映射到 `pyproject.toml` 中的功能。
- `pm/`, `research/`, 和 `index/` 存放具有独立 `package.json` 的 TypeScript 智能体。
- `skills/` 存放运行时技能 (例如：`confidence-check`)；`commands/` 则记录了脚本化的 Claude 命令。
- `docs/` 提供参考文档包；从 `docs/developer-guide` 开始了解工作流预期。

## 构建、测试与开发命令
- `make install` 通过 `uv pip install -e ".[dev]"` 以可编辑模式安装框架。
- `make test` 在 `tests/` 目录下运行 `uv run pytest`。
- `make doctor` 或 `make verify` 检查 CLI 连线和插件健康状况。
- `make lint` 和 `make format` 委托给 Ruff 处理；在进行重大修改后运行。
- TypeScript 智能体：在 `pm/` 目录下运行一次 `npm install`，然后执行 `npm test` 或 `npm run build`；对 `research/` 和 `index/` 目录重复此操作。

## 编码风格与命名规范
- Python：使用 4 空格缩进，Black 行长度限制为 88，Ruff 规则使用 `E,F,I,N,W`；模块/函数优先使用 snake_case，类名使用 PascalCase。
- 保持 pytest 标记显式 (如 `@pytest.mark.unit` 等)，且文件名应符合 `test_*.py`。
- TypeScript：依赖项目的 `tsconfig.json`；文件名使用 kebab-case，导出的类使用 PascalCase；与现有的项目管理 (PM) 代理模块保持一致。
- 为非显而易见的编排逻辑预留 docstrings 或行内注释；让清晰的命名发挥主要作用。

## 测试指南
- 默认执行 `make test`；在开发期间可通过 `uv run pytest -m unit` 缩小运行范围。
- 当修改涉及 CLI 或插件启动时，应在 `tests/test_pytest_plugin.py` 中扩展集成测试覆盖范围。
- 确保护盖率聚焦于 `src/superclaude` (`tool.coverage.run`)；调整配置而非跳过逻辑。
- 对于 TypeScript 智能体，在 `__tests__/*.test.ts` 下添加 Jest 测试说明，并通过 `npm run test:coverage` 确保满足覆盖率阈值。

## 提交与拉取请求 (PR) 指南
- 遵循约定式提交 (Conventional Commits) 规范 (`feat:`, `fix:`, `refactor:`)，可参考 `git log`；使用现在时态，摘要保持在 72 字符以内。
- 在每次提交中对相关文件进行分组更新，以简化 bisect 操作和发布说明的生成。
- 在开启 PR 之前，请运行 `make lint`, `make format` 和 `make test`；在 PR 说明中包含验证步骤的摘要。
- 引用关联的 issue (如 `Closes #123`)；对于智能体工作流的变更，请添加简短的复现说明；仅在文档变更时添加截图。
- 当修改所属目录时，请指派 `CODEOWNERS` 中列出的审查者。

## 插件部署技巧
- 使用 `make install-plugin` 将开发插件镜像到 `~/.claude/plugins/pm-agent`；在本地迭代后优先使用 `make reinstall-plugin`。
- 在共享产物链接或发布说明之前，使用 `make test-plugin` 验证插件检测是否正常。
